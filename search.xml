<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>MySQL使用基础</title>
      <link href="/2021/04/15/MySQL%E4%BD%BF%E7%94%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2021/04/15/MySQL%E4%BD%BF%E7%94%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<p>SQL关键字总是大写，以示突出，表名和列名均使用小写。</p><h2 id="外键"><a href="#外键" class="headerlink" title="外键"></a>外键</h2><ul><li>外键并不是通过列名实现的，而是通过定义外键约束实现的：</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE students</span><br><span class="line">ADD CONSTRAINT fk_class_id</span><br><span class="line">FOREIGN KEY (class_id)</span><br><span class="line">REFERENCES classes (id);</span><br></pre></td></tr></table></figure><p>其中，外键约束的名称<code>fk_class_id</code>可以任意，<code>FOREIGN KEY (class_id)</code>指定了<code>class_id</code>作为外键，<code>REFERENCES classes (id)</code>指定了这个外键将关联到<code>classes</code>表的<code>id</code>列（即<code>classes</code>表的主键）。</p><p>通过定义外键约束，关系数据库可以保证无法插入无效的数据。即如果<code>classes</code>表不存在<code>id=99</code>的记录，<code>students</code>表就无法插入<code>class_id=99</code>的记录。</p><ul><li>删除一个外键约束，也是通过<code>ALTER TABLE</code>实现的：</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE students</span><br><span class="line">DROP FOREIGN KEY fk_class_id;</span><br></pre></td></tr></table></figure><p>注意：删除外键约束并没有删除外键这一列。删除列是通过<code>DROP COLUMN ...</code>实现的。</p><ul><li><p>多对多通过一个中间表（关系表）关联两个一对多关系形成多对多关系</p></li><li><p>一对一关系是指，一个表的记录对应到另一个表的唯一一个记录。</p></li></ul><h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><ul><li>对<code>score</code>列创建索引：</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE students</span><br><span class="line">ADD INDEX idx_score (score);</span><br></pre></td></tr></table></figure><p>​使用<code>ADD INDEX idx_score (score)</code>就创建了一个名称为<code>idx_score</code>，使用列<code>score</code>的索引。索引名称是任意的，索引如果有多列，可以在括号里依次写上<code>ADD INDEX idx_name_score (name, score);</code></p><p>​索引的效率取决于索引列的值是否散列，即该列的值如果越互不相同，那么索引效率越高。</p><p>​索引的优点是提高了查询效率，缺点是在插入、更新和删除记录时，需要同时修改索引。</p><ul><li>唯一索引</li></ul><p>不适宜作为主键，但又具备唯一性约束，可以添加唯一索引</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ADD UNIQUE INDEX uni_name (name);</span><br></pre></td></tr></table></figure><p>也可以只创建唯一约束而不创建唯一索引，仍具备唯一性保证</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE students</span><br><span class="line">ADD CONSTRAINT uni_name UNIQUE (name);</span><br></pre></td></tr></table></figure><h2 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h2><ul><li>查询数据库表的数据，我们使用如下的SQL语句：</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM &lt;表名&gt;</span><br></pre></td></tr></table></figure><ul><li>条件查询的语法就是：</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM &lt;表名&gt; WHERE &lt;条件表达式&gt;</span><br></pre></td></tr></table></figure><ul><li>条件表达式可以用<code>&lt;条件1&gt; AND &lt;条件2&gt;</code>，<code>&lt;条件1&gt; OR &lt;条件2&gt;</code>，<code>NOT &lt;条件&gt;</code></li></ul><p>用小括号<code>()</code>表示如何进行条件的组合：</p><p><code>SELECT * FROM students WHERE (score &lt; 80 OR score &gt; 90) AND gender = &#39;M&#39;;</code></p><ul><li><h3 id="常用的条件表达式"><a href="#常用的条件表达式" class="headerlink" title="常用的条件表达式"></a>常用的条件表达式</h3><table><thead><tr><th align="left">条件</th><th align="left">表达式举例1</th><th align="left">表达式举例2</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">使用&#x3D;判断相等</td><td align="left">score &#x3D; 80</td><td align="left">name &#x3D; ‘abc’</td><td align="left">字符串需要用单引号括起来</td></tr><tr><td align="left">使用&gt;判断大于</td><td align="left">score &gt; 80</td><td align="left">name &gt; ‘abc’</td><td align="left">字符串比较根据ASCII码，中文字符比较根据数据库设置</td></tr><tr><td align="left">使用&gt;&#x3D;判断大于或相等</td><td align="left">score &gt;&#x3D; 80</td><td align="left">name &gt;&#x3D; ‘abc’</td><td align="left"></td></tr><tr><td align="left">使用&lt;判断小于</td><td align="left">score &lt; 80</td><td align="left">name &lt;&#x3D; ‘abc’</td><td align="left"></td></tr><tr><td align="left">使用&lt;&#x3D;判断小于或相等</td><td align="left">score &lt;&#x3D; 80</td><td align="left">name &lt;&#x3D; ‘abc’</td><td align="left"></td></tr><tr><td align="left">使用&lt;&gt;判断不相等</td><td align="left">score &lt;&gt; 80</td><td align="left">name &lt;&gt; ‘abc’</td><td align="left"></td></tr><tr><td align="left">使用LIKE判断相似</td><td align="left">name LIKE ‘ab%’</td><td align="left">name LIKE ‘%bc%’</td><td align="left">%表示任意字符，例如’ab%’将匹配’ab’，’abc’，’abcd’</td></tr></tbody></table></li><li><p>可以用<code>SELECT 列1, 列2, 列3 FROM ...</code>，让结果集仅包含指定列。这种操作称为投影查询。</p></li><li><p>使用<code>SELECT 列1 别名1, 列2 别名2, 列3 别名3 FROM ...</code>时，还可以给每一列起个别名，结果集的列名就会被别名替换。</p></li><li><p>查询结果通常根据主键排序，可以加上<code>ORDER BY</code>子句，按照对应的查找条件由低到高排序。</p></li></ul><p>eg：<code>SELECT id, name, gender, score FROM students ORDER BY score;</code></p><p>默认采用<code>ASC</code>排序规则，即升序。可以加上<code>DESC</code>表示“倒序”：<code>SELECT id, name, gender, score FROM students ORDER BY score DESC;</code></p><p>若要进一步增加排序条件可以继续添加列名。</p><h2 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h2><p>确定<code>LIMIT</code>和<code>OFFSET</code>应该设定的值：</p><ul><li><p><code>LIMIT</code>总是设定为<code>pageSize</code>；</p></li><li><p><code>OFFSET</code>计算公式为<code>pageSize * (pageIndex - 1)</code>。</p><p><code>OFFSET</code>超过了查询的最大数量并不会报错，而是得到一个空的结果集。</p></li></ul><p>MySQL中，<code>LIMIT 15 OFFSET 30</code>还可以简写成<code>LIMIT 30, 15</code>。</p><h2 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a>聚合查询</h2><p>使用SQL内置的<code>COUNT()</code>函数查询</p><p>SELECT COUNT(内容)  别名 FROM students;</p><p>还有如下聚合函数：</p><table><thead><tr><th align="left">函数</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">SUM</td><td align="left">计算某一列的合计值，该列必须为数值类型</td></tr><tr><td align="left">AVG</td><td align="left">计算某一列的平均值，该列必须为数值类型</td></tr><tr><td align="left">MAX</td><td align="left">计算某一列的最大值</td></tr><tr><td align="left">MIN</td><td align="left">计算某一列的最小值</td></tr></tbody></table><p><code>GROUP BY</code>执行分组，会把<code>class_id</code>相同的列先分组，再分别计算</p><h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><p>SELECT查询不但可以从一张表查询数据，还可以从多张表同时查询数据。查询多张表的语法是：<code>SELECT * FROM &lt;表1&gt; &lt;表2&gt;</code>。</p><p><code>students</code>表的每一行与<code>classes</code>表的每一行都两两拼在一起返回。结果集的列数是<code>students</code>表和<code>classes</code>表的列数之和，行数是<code>students</code>表和<code>classes</code>表的行数之积</p><h2 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h2><p>JOIN查询需要先确定主表，然后把另一个表的数据“附加”到结果集上；</p><p>INNER JOIN是最常用的一种JOIN查询，它的语法是<code>SELECT ... FROM &lt;表1&gt; INNER JOIN &lt;表2&gt; ON &lt;条件...&gt;</code>；</p><p>JOIN查询仍然可以使用<code>WHERE</code>条件和<code>ORDER BY</code>排序。</p><p>使用最常用的一种内连接——INNER JOIN</p><ol><li>先确定主表，仍然使用<code>FROM &lt;表1&gt;</code>的语法；</li><li>再确定需要连接的表，使用<code>INNER JOIN &lt;表2&gt;</code>的语法；</li><li>然后确定连接条件，使用<code>ON &lt;条件...&gt;</code>，这里的条件是<code>s.class_id = c.id</code>，表示<code>students</code>表的<code>class_id</code>列与<code>classes</code>表的<code>id</code>列相同的行需要连接；</li><li>可选：加上<code>WHERE</code>子句、<code>ORDER BY</code>等子句。</li></ol><p>eg：<code>SELECT s.id, s.name, s.class_id, c.name class_name, s.gender, s.score</code><br><code>FROM students s</code><br><code>INNER JOIN classes c</code><br><code>ON s.class_id=c.id;</code></p><p>OUT JOIN</p><p>包括：LEFT  RIGHT FULL</p><p>LEFT OUTER JOIN是选出左表存在的记录：</p><p><img src="https://www.liaoxuefeng.com/files/attachments/1246893588481376/l" alt="left-outer-join"></p><p>RIGHT OUTER JOIN是选出右表存在的记录：</p><p><img src="https://www.liaoxuefeng.com/files/attachments/1246893609222688/l" alt="right-outer-join"></p><p>FULL OUTER JOIN则是选出左右表都存在的记录：</p><p><img src="https://www.liaoxuefeng.com/files/attachments/1246893632359424/l" alt="full-outer-join"></p><h2 id="数据库的增删查改"><a href="#数据库的增删查改" class="headerlink" title="数据库的增删查改"></a>数据库的增删查改</h2><ul><li><p>INSERT：插入新记录；</p></li><li><p>UPDATE：更新已有记录；</p></li><li><p>DELETE：删除已有记录。</p></li><li><p><code>INSERT</code>语句的基本语法是：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO &lt;表名&gt; (字段1, 字段2, ...) VALUES (值1, 值2, ...);</span><br></pre></td></tr></table></figure></li><li><p><code>UPDATE</code>语句的基本语法是：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE &lt;表名&gt; SET 字段1=值1, 字段2=值2, ... WHERE ...;</span><br></pre></td></tr></table></figure></li><li><p><code>UPDATE</code>语句可以没有<code>WHERE</code>条件</p></li><li><p><code>DELETE</code>语句的基本语法是：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM &lt;表名&gt; WHERE ...;</span><br></pre></td></tr></table></figure></li></ul><p>MySQL Client和MySQL Server的关系如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──────────────┐  SQL   ┌──────────────┐</span><br><span class="line">│ MySQL Client │───────&gt;│ MySQL Server │</span><br><span class="line">└──────────────┘  TCP   └──────────────┘</span><br></pre></td></tr></table></figure><p>MySQL Server的IP地址是<code>10.0.1.99</code>，那么就使用<code>-h</code>指定IP或域名：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h 10.0.1.99 -u root -p</span><br></pre></td></tr></table></figure><p>列出所有数据库：show databases;</p><p><code>information_schema</code>、<code>mysql</code>、<code>performance_schema</code>和<code>sys</code>是系统库</p><p>创建新数据库：create database+数据库名称；</p><p>删除数据库：DROP DATABASE test;</p><p>创建新的数据表：CREATE TABLE table_name；</p><p>对数据库操作前，需要将操作对象更改为当前数据库：use + 数据库名；</p><p>列出当前数据库包含的所有表：show tables；</p><p>查看表的结构:desc +表名；</p>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
